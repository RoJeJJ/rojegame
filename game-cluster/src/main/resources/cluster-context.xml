<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">
    <context:property-placeholder location="classpath:cluster*.*properties"/>
    <import resource="classpath:cluster-config.xml"/>
    <bean class="com.roje.game.core.dispatcher.MessageDispatcher" id="messageDispatcher"/>
    <bean class="com.roje.game.core.manager.ServerManager" id="serverManager"/>
    <bean id="tcpServerChannelInitializer" class="com.roje.game.core.netty.channel.initializer.DefaultTcpServerChannelInitializer">
        <constructor-arg ref="clusterTcpServerConfig"/>
        <property name="handlers">
            <list>
                <bean class="com.roje.game.cluster.netty.handler.ClusterGameServerChannelInBoundHandler">
                    <constructor-arg name="containUid" value="false"/>
                    <constructor-arg name="service" ref="clusterTcpServer"/>
                    <constructor-arg name="dispatcher" ref="messageDispatcher"/>
                    <property name="serverManager" ref="serverManager"/>
                </bean>
            </list>
        </property>
    </bean>
    <bean class="com.roje.game.core.netty.channel.initializer.DefaultHttpServerChannelInitializer" id="httpServerChannelInitializer">
        <constructor-arg name="httpServerConfig" ref="clusterHttpServerConfig"/>
        <property name="handlers">
            <list>
                <bean class="com.roje.game.core.netty.channel.handler.DefaultHttpInBoundHandler">
                    <property name="service" ref="clusterHttpServer"/>
                    <property name="dispatcher" ref="messageDispatcher"/>
                </bean>
            </list>
        </property>
    </bean>
    <bean id="nettyTcpServer" class="com.roje.game.core.netty.NettyTcpServer">
        <constructor-arg index="0" ref="tcpServerChannelInitializer"/>
        <constructor-arg index="1" ref="clusterTcpServerConfig"/>
    </bean>
    <bean class="com.roje.game.core.netty.NettyHttpServer" id="nettyHttpServer">
        <constructor-arg index="0" name="initializer" ref="httpServerChannelInitializer"/>
        <constructor-arg index="1" name="serverConfig" ref="clusterHttpServerConfig"/>
    </bean>
    <!--集群tcp服务器-->
    <bean id="clusterTcpServer" class="com.roje.game.cluster.server.ClusterTcpTcpServer">
        <constructor-arg index="0" name="config" ref="threadConfig"/>
        <constructor-arg index="1" ref="nettyTcpServer"/>
    </bean>
    <!--集群http服务器-->
    <bean class="com.roje.game.cluster.server.ClusterHttpTcpServer" id="clusterHttpServer">
        <constructor-arg name="config" ref="threadConfig"/>
        <constructor-arg name="httpServer" ref="nettyHttpServer"/>
    </bean>

    <!--processor-->
    <bean class="com.roje.game.cluster.processor.ServerRegProcessor" init-method="register">
        <property name="dispatcher" ref="messageDispatcher"/>
        <property name="serverManager" ref="serverManager"/>
    </bean>
    <bean class="com.roje.game.cluster.processor.ServerUpdateProcessor" init-method="register">
        <property name="dispatcher" ref="messageDispatcher"/>
        <property name="serverManager" ref="serverManager"/>
    </bean>
    <bean class="com.roje.game.cluster.processor.http.GetIdleGateProcessor" init-method="register">
        <property name="serverManager" ref="serverManager"/>
        <property name="dispatcher" ref="messageDispatcher"/>
    </bean>
</beans>